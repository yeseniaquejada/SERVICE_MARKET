create database CRUD_ADMIN
use CRUD_ADMIN;

CREATE TABLE ROLES(
ID_ROL INT IDENTITY(1,1) PRIMARY KEY,
NOMBRE_ROL VARCHAR(40) NOT NULL)

/*INSERT TABLA ROLES*/
INSERT INTO ROLES(NOMBRE_ROL) VALUES ('ADMINISTRADOR'),('PRESTADOR_SERVICIOS'),('CLIENTE')

SELECT * FROM ROLES 

/*CREACION DE LA TABLA CIUDAD*/
CREATE TABLE CIUDAD(
ID_CIUDAD INT PRIMARY KEY IDENTITY(1,1),
NOMBRE_CIUDAD VARCHAR(50) NOT NULL)

/*INSERT TABLA ROLES*/
INSERT INTO CIUDAD(NOMBRE_CIUDAD) VALUES ('MEDELLIN'),('CALDAS'),('BARBOSA'),('SABANETA'),('LA ESTRELLA'),('ITAGUI'),
('ENVIGADO'),('BELLO'),('GIRARDOTA'),('COPACABANA')

SELECT * FROM CIUDAD

/*CREACION DE LA TABLA USUARIOS*/
CREATE TABLE USUARIOS(
N_IDENTIFICACION VARCHAR(15) PRIMARY KEY,
TIPO_DOC VARCHAR(40) NOT NULL,
FECHA_NACIMIENTO DATE NOT NULL,
FECHA_EXPEDICION DATE NOT NULL,
NOMBRE_USU VARCHAR(60) NOT NULL,
APELLIDOS_USU VARCHAR(70) NOT NULL,
CELULAR_USU VARCHAR(12) NOT NULL,
CORREO_ELECTRONICO VARCHAR(100) NOT NULL,
CONTRASENA VARCHAR(500) NOT NULL,
GENERO VARCHAR(80) NOT NULL,
ID_CIUDAD_FK INT REFERENCES CIUDAD(ID_CIUDAD),
DIRECCION VARCHAR(200) NOT NULL
)

SELECT * FROM USUARIOS

/*CREACION DE LA TABLA INTERMEDIA ASIGNACION_ROL*/
CREATE TABLE ASIGNACION_ROL(
ID_ROL_FK INT REFERENCES ROLES(ID_ROL) DEFAULT 3,
IDENTIFICACION_U_FK VARCHAR(15) REFERENCES USUARIOS(N_IDENTIFICACION)
)

SELECT * FROM ASIGNACION_ROL

CREATE TABLE CATEGORIAS(
ID_CATEGORIA INT IDENTITY(1,1) PRIMARY KEY,
NOMBRE_CAT VARCHAR(MAX) NOT NULL,
DESCRIPCION_CAT VARCHAR(MAX) NOT NULL)

SELECT * FROM CATEGORIAS

/*INSERT TABLA CATEGORIAS*/
INSERT INTO CATEGORIAS(NOMBRE_CAT,DESCRIPCION_CAT) VALUES 
('MANTENIMIENTO','ORIENTADA A SOLUCIONAR Y PREVENIR LAS POSIBLES AVERÍAS QUE PUEDA HABER EN EQUIPOS, MÁQUINAS E INSTALACIONES PARA CONSERVAR Y GARANTIZAR SU ÓPTIMO FUNCIONAMIENTO.'),
('TRABAJOS DOMÉSTICOS','TODA LA AYUDA DOMÉSTICA QUE NECESITAS EN CASA CON EXPERTAS EN ORDEN, LIMPIEZA Y DESINFECCIÓN.'),
('REMODELACIÓN Y ALBAÑILERÍA','ORIENTADA EN LA CONSTRUCCIÓN, RENOVACIÓN Y REPARACIÓN DE ESTRUCTURAS, PAREDES, MUROS, PARTES DE EDIFICIOS, CASAS Y MÁS.'),
('SALUD Y BELLEZA','ORIENTADA A LA PRESTACIÓN DE SERVICIOS DESDE LOS DIFERENTES CAMPOS DE LA SALUD Y LA BELLEZA COMO LO SON CORTES, PEINADOS, MAQUILLAJES, MANICURE, PEDICURA, MASAJES, ETC.')

/*CREACION DE LA TABLA SERVICIOS*/
CREATE TABLE SERVICIOS(
ID_SERVICIO INT IDENTITY(1,1) PRIMARY KEY,
NOMBRE_SER VARCHAR(70) NOT NULL,
PRECIO_SER DECIMAL NOT NULL,
DESCRIPCION_BREVE VARCHAR(500) NOT NULL,
TERMINOS_SER VARCHAR(MAX) NOT NULL,
ID_CATEGORIA_FK INT REFERENCES CATEGORIAS(ID_CATEGORIA)

/*CRUD ADMIN AGREGAR CATEGORIAS */
CREATE PROCEDURE CRUD_ADMIN_CAT(
@ID_CATEGORIA INT,
@NOMBRE_CAT VARCHAR,
@DESCRIPCION_CAT VARCHAR)
AS 


BEGIN
	INSERT INTO CATEGORIAS(NOMBRE_CAT,DESCRIPCION_CAT) 
	VALUES (@NOMBRE_CAT,@DESCRIPCION_CAT)
END;
GO
EXECUTE CRUD_ADMIN_CAT '', @NOMBRE_CAT ='PERROS', @DESCRIPCION_CAT='BSASJBJSDBSJX'

/*CRUD ADMIN ACTUALIZAR CATEGORIAS */
CREATE PROCEDURE CRUD_ADMIN_CAT2(
@ID_CATEGORIA INT,
@NOMBRE_CAT VARCHAR,
@DESCRIPCION_CAT VARCHAR)
AS 
BEGIN
UPDATE CATEGORIAS SET  NOMBRE_CAT=@NOMBRE_CAT, DESCRIPCION_CAT=@DESCRIPCION_CAT WHERE ID_CATEGORIA=@ID_CATEGORIA
END;
GO

EXECUTE CRUD_ADMIN_CAT2 '3', @NOMBRE_CAT ='PATOS', @DESCRIPCION_CAT='CSASJBJSDBSJX'
DROP PROCEDURE CRUD_ADMIN_CAT2

SELECT*FROM CATEGORIAS

/*CRUD ADMIN ELIMINAR CATEGORIAS */
CREATE PROCEDURE CRUD_ADMIN_CAT3(
@ID_CATEGORIA INT,
@NOMBRE_CAT VARCHAR,
@DESCRIPCION_CAT VARCHAR)
AS 
BEGIN
DELETE FROM CATEGORIAS WHERE ID_CATEGORIA=@ID_CATEGORIA
END;
GO
EXECUTE CRUD_ADMIN_CAT3 '1', @NOMBRE_CAT ='GATOS', @DESCRIPCION_CAT='DSASJBJSDBSJX'

DBCC CHECKIDENT (CATEGORIAS, RESEED, 0)

/* CRUD ADMIN AGREGAR SERVICIOS*/
CREATE PROCEDURE CRUD_ADMIN_SER(
@ID_SERVICIO INT,
@NOMBRE_SER VARCHAR,
 @PRECIO_SER DECIMAL,
@DESCRIPCION_BREVE VARCHAR,
@TERMINOS_SER VARCHAR)
AS 

BEGIN
	INSERT INTO SERVICIOS(NOMBRE_SER, PRECIO_SER, DESCRIPCION_BREVE, TERMINOS_SER) 
	VALUES (@NOMBRE_SER, @PRECIO_SER, @DESCRIPCION_BREVE, @TERMINOS_SER)
END;
GO

EXEC  CRUD_ADMIN_SER '', @NOMBRE_SER='VALE', @PRECIO_SER=463473, @DESCRIPCION_BREVE='VSHAXHA', @TERMINOS_SER='NO'

/* CRUD ADMIN ACTUALIZAR SERVICIOS*/
CREATE PROCEDURE CRUD_ADMIN_SER2(
@ID_SERVICIO INT,
@NOMBRE_SER VARCHAR,
 @PRECIO_SER DECIMAL,
@DESCRIPCION_BREVE VARCHAR,
@TERMINOS_SER VARCHAR)
AS 
BEGIN
UPDATE SERVICIOS SET  NOMBRE_SER=@NOMBRE_SER, PRECIO_SER=@PRECIO_SER , DESCRIPCION_BREVE=@DESCRIPCION_BREVE, TERMINOS_SER=@TERMINOS_SER
WHERE ID_SERVICIO=@ID_SERVICIO
END;

EXEC  CRUD_ADMIN_SER2 '2', @NOMBRE_SER='CALENTINA', @PRECIO_SER=463473, @DESCRIPCION_BREVE='VSHAXHA', @TERMINOS_SER='NO'

/* CRUD ADMIN ELIMINAR SERVICIOS*/
CREATE PROCEDURE CRUD_ADMIN_SER3(
@ID_SERVICIO INT,
@NOMBRE_SER VARCHAR,
 @PRECIO_SER DECIMAL,
@DESCRIPCION_BREVE VARCHAR,
@TERMINOS_SER VARCHAR)
AS 
BEGIN
DELETE FROM SERVICIOS WHERE ID_SERVICIO=@ID_SERVICIO
END;
GO

EXECUTE CRUD_ADMIN_SER3 @ID_SERVICIO='1',  @NOMBRE_SER='VALE', @PRECIO_SER=463473, @DESCRIPCION_BREVE='VSHAXHA', @TERMINOS_SER='NO'
SELECT * FROM SERVICIOS

/* CRUD ADMIN AGREGAR USUARIOS*/
CREATE PROCEDURE CRUD_ADMIN_USU(
@N_IDENTIFICACION VARCHAR,
@TIPO_DOC VARCHAR,
@FECHA_NACIMIENTO DATE,
@FECHA_EXPEDICION DATE,
@NOMBRE_USU VARCHAR,
@APELLIDOS_USU VARCHAR,
@CELULAR_USU VARCHAR,
@CORREO_ELECTRONICO VARCHAR,
@CONTRASENA VARCHAR,
@GENERO VARCHAR,
@ID_CIUDAD_FK INT,
@DIRECCION VARCHAR
)
AS
BEGIN
INSERT INTO USUARIOS (N_IDENTIFICACION, TIPO_DOC, FECHA_NACIMIENTO,FECHA_EXPEDICION ,NOMBRE_USU, APELLIDOS_USU, CELULAR_USU,
CORREO_ELECTRONICO, CONTRASENA, GENERO , ID_CIUDAD_FK, DIRECCION) 
VALUES (@N_IDENTIFICACION, @TIPO_DOC,@FECHA_NACIMIENTO,@FECHA_EXPEDICION ,@NOMBRE_USU, @APELLIDOS_USU, @CELULAR_USU,
@CORREO_ELECTRONICO, @CONTRASENA,@GENERO , @ID_CIUDAD_FK, @DIRECCION) 
END;
GO
EXEC CRUD_ADMIN_USU @N_IDENTIFICACION='32356', @TIPO_DOC='C',@FECHA_NACIMIENTO= '2008-03-31',@FECHA_EXPEDICION='2019-03-31'
,@NOMBRE_USU='VAL', @APELLIDOS_USU='FLO', @CELULAR_USU='JJKB',
@CORREO_ELECTRONICO='@DNNSKK', @CONTRASENA='12356',@GENERO ='F', @ID_CIUDAD_FK=2, @DIRECCION='CAL-21 # 34.65'

SELECT* FROM USUARIOS
/*CRUD ADMIN ACTUALIZAR USUARIO*/
CREATE PROCEDURE CRUD_ADMIN_USU2(
@N_IDENTIFICACION VARCHAR,
@TIPO_DOC VARCHAR,
@FECHA_NACIMIENTO DATE,
@FECHA_EXPEDICION DATE,
@NOMBRE_USU VARCHAR,
@APELLIDOS_USU VARCHAR,
@CELULAR_USU VARCHAR,
@CORREO_ELECTRONICO VARCHAR,
@CONTRASENA VARCHAR,
@GENERO VARCHAR,
@ID_CIUDAD_FK INT,
@DIRECCION VARCHAR
)
AS
BEGIN
UPDATE USUARIOS SET N_IDENTIFICACION=@N_IDENTIFICACION, TIPO_DOC=@TIPO_DOC, FECHA_NACIMIENTO=@FECHA_NACIMIENTO,FECHA_EXPEDICION=@FECHA_EXPEDICION,
NOMBRE_USU=@NOMBRE_USU, APELLIDOS_USU=@APELLIDOS_USU, CELULAR_USU=@CELULAR_USU,
CORREO_ELECTRONICO=@CORREO_ELECTRONICO, CONTRASENA=@CONTRASENA, GENERO=@GENERO , ID_CIUDAD_FK=@ID_CIUDAD_FK, DIRECCION=@DIRECCION  WHERE  N_IDENTIFICACION=@N_IDENTIFICACION
END;
GO
DROP PROCEDURE CRUD_ADMIN_USU2
SELECT* FROM USUARIOS

EXEC CRUD_ADMIN_USU2 @N_IDENTIFICACION='1234', @TIPO_DOC='T',@FECHA_NACIMIENTO= '2008-03-31',@FECHA_EXPEDICION='2019-03-31'
,@NOMBRE_USU='VAL', @APELLIDOS_USU='FLO', @CELULAR_USU='JJKB',
@CORREO_ELECTRONICO='@DNNSKK', @CONTRASENA='1234',@GENERO ='F', @ID_CIUDAD_FK=2, @DIRECCION='CAL-21 # 34.65'
 SELECT * FROM USUARIOS


/*CRUD ADMIN ELIMINAR USUARIO*/
CREATE PROCEDURE CRUD_ADMIN_USU3(
@N_IDENTIFICACION VARCHAR,
@TIPO_DOC VARCHAR,
@FECHA_NACIMIENTO DATE,
@FECHA_EXPEDICION DATE,
@NOMBRE_USU VARCHAR,
@APELLIDOS_USU VARCHAR,
@CELULAR_USU VARCHAR,
@CORREO_ELECTRONICO VARCHAR,
@CONTRASENA VARCHAR,
@GENERO VARCHAR,
@ID_CIUDAD_FK INT,
@DIRECCION VARCHAR
)
AS
BEGIN
DELETE USUARIOS WHERE N_IDENTIFICACION=@N_IDENTIFICACION
END;
GO

EXEC CRUD_ADMIN_USU3 @N_IDENTIFICACION='32356', @TIPO_DOC='C',@FECHA_NACIMIENTO= '2008-03-31',@FECHA_EXPEDICION='2019-03-31'
,@NOMBRE_USU='VAL', @APELLIDOS_USU='FLO', @CELULAR_USU='JJKB',
@CORREO_ELECTRONICO='@DNNSKK', @CONTRASENA='12356',@GENERO ='F', @ID_CIUDAD_FK=2, @DIRECCION='CAL-21 # 34.65'

SELECT* FROM CATEGORIAS
SELECT* FROM SERVICIOS
SELECT* FROM USUARIOS